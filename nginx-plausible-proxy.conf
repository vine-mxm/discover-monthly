# ============================================
# Nginx Configuration for Plausible Proxy
# ============================================
# 
# This configuration allows you to bypass adblockers by proxying
# Plausible Analytics through your own domain.
#
# Add this to your nginx site configuration file:
# /etc/nginx/sites-available/sixonesixo.com
#
# ============================================

# Proxy for Plausible script
location = /js/script.js {
    proxy_pass https://plausible.io/js/pa-rWmBoMcNT_gy0zddG-1if.js;
    proxy_set_header Host plausible.io;
    proxy_ssl_server_name on;
    proxy_ssl_protocols TLSv1.2 TLSv1.3;
    
    # Caching headers
    proxy_cache_valid 200 6h;
    add_header X-Cache-Status $upstream_cache_status;
}

# Proxy for Plausible API endpoint (events tracking)
location = /api/event {
    proxy_pass https://plausible.io/api/event;
    proxy_set_header Host plausible.io;
    proxy_ssl_server_name on;
    proxy_ssl_protocols TLSv1.2 TLSv1.3;
    
    # Forward client information
    proxy_buffering on;
    proxy_http_version 1.1;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    
    # Important: preserve client IP for accurate geolocation
    proxy_set_header X-Real-IP $remote_addr;
}

# ============================================
# INSTALLATION INSTRUCTIONS
# ============================================
#
# 1. Open your nginx site configuration:
#    sudo nano /etc/nginx/sites-available/sixonesixo.com
#
# 2. Add the location blocks above inside your server { } block
#
# 3. Test nginx configuration:
#    sudo nginx -t
#
# 4. Reload nginx:
#    sudo systemctl reload nginx
#
# 5. Update your HTML files to use the proxied script:
#    Change:
#      <script async src="https://plausible.io/js/pa-rWmBoMcNT_gy0zddG-1if.js"></script>
#    To:
#      <script async src="/js/script.js"></script>
#
# ============================================
# FULL EXAMPLE SERVER BLOCK
# ============================================
#
# server {
#     listen 80;
#     listen 443 ssl http2;
#     server_name sixonesixo.com www.sixonesixo.com;
#
#     # SSL configuration (if using HTTPS)
#     ssl_certificate /etc/letsencrypt/live/sixonesixo.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/sixonesixo.com/privkey.pem;
#
#     root /var/www/sixonesixo.com/public;
#     index index.html;
#
#     # Plausible proxy configuration
#     location = /js/script.js {
#         proxy_pass https://plausible.io/js/pa-rWmBoMcNT_gy0zddG-1if.js;
#         proxy_set_header Host plausible.io;
#         proxy_ssl_server_name on;
#         proxy_ssl_protocols TLSv1.2 TLSv1.3;
#         proxy_cache_valid 200 6h;
#         add_header X-Cache-Status $upstream_cache_status;
#     }
#
#     location = /api/event {
#         proxy_pass https://plausible.io/api/event;
#         proxy_set_header Host plausible.io;
#         proxy_ssl_server_name on;
#         proxy_ssl_protocols TLSv1.2 TLSv1.3;
#         proxy_buffering on;
#         proxy_http_version 1.1;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_set_header X-Forwarded-Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
#
#     # Serve static files
#     location / {
#         try_files $uri $uri/ =404;
#     }
# }
#
# ============================================
# ALTERNATIVE: Apache Configuration
# ============================================
#
# If you're using Apache instead of Nginx, use this configuration:
#
# <VirtualHost *:80>
#     ServerName sixonesixo.com
#     DocumentRoot /var/www/sixonesixo.com/public
#
#     # Enable required modules: a2enmod proxy proxy_http ssl headers
#
#     # Plausible script proxy
#     ProxyPass /js/script.js https://plausible.io/js/pa-rWmBoMcNT_gy0zddG-1if.js
#     ProxyPassReverse /js/script.js https://plausible.io/js/pa-rWmBoMcNT_gy0zddG-1if.js
#
#     # Plausible API proxy
#     ProxyPass /api/event https://plausible.io/api/event
#     ProxyPassReverse /api/event https://plausible.io/api/event
#     ProxyPreserveHost On
#
#     <Directory /var/www/sixonesixo.com/public>
#         Options Indexes FollowSymLinks
#         AllowOverride All
#         Require all granted
#     </Directory>
# </VirtualHost>
#
# ============================================
