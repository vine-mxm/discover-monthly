<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DISCOVER MONTHLY - PLAYLIST</title>
  <link rel="stylesheet" href="css/style.css">
  
  <!-- Privacy-friendly analytics by Plausible (proxied) -->
  <script async src="/js/script.js"></script>
  <script>
    window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
    plausible.init()
  </script>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-logo"></div>
    <div class="header-content">
      <div class="title">
        <a href="index.html" style="color: inherit; text-decoration: none;">← DISCOVER MONTHLY</a>
      </div>
      <div class="stats">
        <div class="stat">
          <span>PLAYLIST:</span>
          <span class="stat-value" id="playlistName">--</span>
        </div>
        <div class="stat">
          <span>TRACKS:</span>
          <span class="stat-value" id="trackCount">--</span>
        </div>
      </div>
    </div>
    <div class="header-hypercube active" id="headerHypercube"></div>
  </div>

  <!-- Content -->
  <div class="content" style="height: calc(100vh - 73px); border-right: none;">
    <div class="loading">LOADING...</div>
  </div>

  <script type="module">
    // Header wave animation
    function animateHeaderHypercube() {
      const container = document.getElementById('headerHypercube');
      if (!container) return;
      
      let offset = 0;
      const width = 8;
      const height = 7;
      
      function drawWave() {
        offset += 0.15;
        
        const canvas = Array(height).fill().map(() => Array(width).fill(' '));
        
        // Draw sine wave
        for (let x = 0; x < width; x++) {
          const angle = (x / width) * Math.PI * 2 + offset;
          const sine = Math.sin(angle);
          const y = Math.round((sine + 1) * (height - 1) / 2);
          
          if (y >= 0 && y < height) {
            canvas[y][x] = '·';
          }
        }
        
        container.textContent = canvas.map(row => row.join('')).join('\n');
      }
      
      setInterval(drawWave, 50);
    }

    // Start wave animation
    animateHeaderHypercube();
  </script>

  <script type="module">
    // Get playlist ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const playlistId = urlParams.get('id');

    if (!playlistId) {
      window.location.href = 'index.html';
    }

    // Load playlist data
    async function loadPlaylist() {
      try {
        const response = await fetch('../data/playlists.json');
        const data = await response.json();
        
        const playlist = data.playlists.find(p => p.id === playlistId);
        
        if (!playlist) {
          throw new Error('Playlist not found');
        }
        
        displayPlaylist(playlist);
      } catch (error) {
        console.error('Error loading playlist:', error);
        document.querySelector('.content').innerHTML = `
          <div class="error-box">
            ERROR: FAILED TO LOAD PLAYLIST<br>
            ${error.message}
          </div>
        `;
      }
    }

    function displayPlaylist(playlist) {
      // Set header
      document.getElementById('playlistName').textContent = playlist.name;
      document.getElementById('trackCount').textContent = playlist.tracks.length;
      
      // Render tracks
      const contentEl = document.querySelector('.content');
      
      let html = `
        <div class="content-header">
          <div class="content-title">${playlist.name}</div>
          <div class="content-meta">${playlist.tracks.length} TRACKS</div>
        </div>
        <div class="track-list">
      `;
      
      playlist.tracks.forEach((track, index) => {
        const links = [];
        if (track.links?.appleMusic) links.push(`<a href="${track.links.appleMusic}" target="_blank">AM</a>`);
        if (track.links?.spotify) links.push(`<a href="${track.links.spotify}" target="_blank">SP</a>`);
        if (track.links?.youtube) links.push(`<a href="${track.links.youtube}" target="_blank">YT</a>`);
        
        const duration = formatDuration(track.duration);
        
        html += `
          <div class="track">
            <div class="track-num">${String(index + 1).padStart(2, '0')}</div>
            <div class="track-artwork">
              ${track.artwork ? `<img src="${track.artwork}" alt="">` : 'NO IMG'}
            </div>
            <div class="track-info">
              <div class="track-title">${escapeHtml(track.title)}</div>
              <div class="track-artist">${escapeHtml(track.artist)}</div>
            </div>
            <div class="track-links">
              ${links.length > 0 ? links.join(' <span class="sep">/</span> ') : '<span style="color: var(--dim)">--</span>'}
            </div>
          </div>
        `;
      });
      
      html += `</div>`;
      contentEl.innerHTML = html;
    }

    function formatDuration(ms) {
      const seconds = Math.floor(ms / 1000);
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = seconds % 60;
      return `${minutes}:${String(remainingSeconds).padStart(2, '0')}`;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load on page ready
    loadPlaylist();
  </script>
</body>
</html>
